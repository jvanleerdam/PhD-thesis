\section{Maximum-Likelihood Fit}
\label{sec:ana_fit}

The fit of the decay model to the data is an \emph{unbinned maximum-likelihood fit}. A probability density function (PDF) is constructed by
normalizing the expression for the differential decay rate, including experimental effects, by dividing by its integral over decay time and
decay angles. A likelihood function of the PDF parameters for one $\Bs$ decay is given by the PDF at the values of time and angles for
that decay. The likelihood function for the full sample of decays is given by the product of all individual likelihoods.

Parameter values are estimated by maximizing the combined likelihood function for the sample. In practice, the negative logarithm of the
likelihood function (NLL) is minimized to find the maximum likelihood. Instead of a product, the NLL is a sum of the contributions from
individual decays.

The shape of the NLL around the minimum can be approximated by a second order Taylor series, i.e. a parabola. Since the first derivative of
this function vanishes at the point where the NLL reaches its minimum, the approximation for a given parameter $\mu$ can be written in the
form
\begin{equation}
  \label{eq:NLLPara}
  \text{NLL}(\mu) \approx \frac{1}{2\,\sigma_\mu^2}\, (\mu-\hat{\mu})^2 + C \ ,
\end{equation}
where $\hat{\mu}$ is the value of parameter $\mu$ in the minimum, $\sigma_\mu$ determines the width of the NLL shape around the minimum,
and $C$ is the NLL value in the minimum. The width, $\sigma_\mu$, is (related to) the statistical uncertainty of the estimate of parameter
$\mu$. The wider the NLL shape around the minimum, the larger the value of $\sigma_\mu$ and thus the uncertainty.

It depends on the actual shape of the NLL how well it is approximated by a parabola away from the minimum. Important factors are
correlations between parameters and the amount of data that is used to build the NLL. With more data the statistical uncertainties of
the parameter estimates become smaller and, in general, the NLL becomes more parabolic within an interval of a few times the value of
$\sigma_\mu$ around the minimum.

In case the distribution of parameter estimates $\hat{\mu}$ from different measurements is described by a Gaussian shape, the shape of the
NLL will be truly parabolic. In this case the parameter $\sigma_\mu$ is an estimate of the standard deviation of the $\hat{\mu}$
distribution, which can be used as a measure of the statistical uncertainty of a parameter estimate. The value of $\sigma_\mu$ is
determined from the second derivative of the NLL, which is given by $\frac{1}{\sigma_\mu^2}$.

If the shape of the NLL around its minimum is not sufficiently parabolic, a different measure of the statistical uncertainty may be used.
Commonly the (absolute) difference between the value of $\mu$ at the point where the NLL reaches a value of $\tfrac{1}{2}+C$ and
$\hat{\mu}$ is taken as the uncertainty. In the parabolic case the NLL reaches this point at $\hat{\mu}+\sigma_\mu$ and
$\hat{\mu}-\sigma_\mu$, which results in an uncertainty of $\sigma_\mu$, as expected. In a more general case this NLL value may be reached
on the left and the right of $\hat{\mu}$ at different distances, which results in an asymmetric uncertainty.

In some cases the shape of the NLL differs from a parabola too much to give a meaningful single estimate of the parameter value and a
corresponding uncertainty. The simplest way to provide an estimate of the value in these cases is to specify the interval bounded by the
values of $\mu$ at a given NLL value. Common NLL values are the values that a parabola would reach at $n\cdot\sigma_\mu$ from the minimum,
which are given by $\tfrac{1}{2}\,n^2+C$. Hence the intervals are referred to as ``$n$ sigma'' intervals.

In general the NLL is a function of more than one parameter. The distribution of parameter estimates in the parabolic approximation is
given by a multivariate Gaussian shape, which includes also correlations between the estimates. Both the uncertainties and the correlations
of the parameter estimates are estimated from the shape of the NLL in the minimum, by determining second derivatives for all pairs
of parameters.

The parabolic shape of Equation~\ref{eq:NLLPara} for a parameter $\mu$ is given by the minimum of the NLL at each $\mu$ value. In the
parabolic approximation the minimum for a given value of $\mu$ is reached at
\begin{equation}
  \frac{1}{\sigma_{\nu_i}}\, (\nu_i-\hat{\nu}_i)  = \rho_{\mu\nu_i}\, \frac{1}{\sigma_\mu}\, (\mu-\hat{\mu})
\end{equation}
for all the other parameters $\nu_i$, where $\rho_{\mu\nu_i}$ is the correlation coefficient between the parameters $\mu$ and $\nu_i$. The
resulting function of parameter $\mu$ is termed \emph{profiled NLL}, the second derivative of which is again equal to
$\frac{1}{\sigma_\mu^2}$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Fit with Weighted Decay Candidates}
\label{subsec:ana_fit_weights}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

As will be described in Section~\ref{sec:ana_bkgSub}, the time and angular distribution for \BstoJpsiKK{} signal decays is obtained by
subtracting the background distribution from the distribution that is observed in the data. This is accomplished by adding background
decay-candidates to the sample with negative weights. In the NLL, the contribution of each decay candidate is then multiplied with the
value of its weight.

Although the position of the minimum of a weighted NLL still gives a good estimate of the values of the NLL parameters, the parameter
uncertainties cannot be estimated directly from the shape of the NLL at its minimum any more. This can be seen by considering a fit in bins
of a given variable, where the observed number of decays in each bin is compared to the prediction of this number by a model. The
uncertainties in the estimates of the model parameters are now related to the uncertainties in the observed number of decays in each bin.

For unweighted decays the distribution of the observed number of decays ($N$) is a Poisson distribution, for which both the mean and the
variance are given by the expected number in the bin ($\nu$). An estimate of the expected number of decays, $\hat{\nu}$, is given by $N$
and an estimate of the corresponding uncertainty by the square root of the estimated variance, $\sqrt{N}$.

In a fit with weighted decay candidates, where each candidate counts with a weight $w_c$, the observed number of decays is replaced by the
sum of weights, $W$\textequiv$\sum_c w_c$. The estimate of $\nu$ is now also given by $W$, as expected, but the uncertainty is estimated by
$\sqrt{W}$, which cannot be correct. If all weights are multiplied by a constant number, $n$, the relative uncertainty in the estimate of
$\nu$ should not change, since no information was added to the data sample. This means that the absolute uncertainty should increase by a
factor $n$, as $\hat{\nu}$\texteq$W$ does. If the uncertainty is estimated by $\sqrt{W}$, it only increases by a factor $\sqrt{n}$.

The correct uncertainty estimate for the expected number of decays is given by the square root of $W'$\textequiv$\sum_c w_c^2$. Unlike
$\sqrt{W}$, $\sqrt{W'}$ increases by a factor $n$ if all weights are multiplied by this common factor. To obtain this estimate of the
uncertainty, the original estimate from the Poisson distribution should be divided by a factor $\sqrt{\alpha}$, where $\alpha$ is given by
\begin{equation}
  \alpha \equiv \frac{W}{W'} = \frac{\sum_c w_c}{\sum_c w_c^2} \ .
\end{equation}

In an unbinned maximum likelihood fit the correction factor $\alpha$ can be used to modify the shape of the NLL. Since the uncertainties
are estimated from the second derivatives of the NLL, which are given by $\frac{1}{\sigma_\mu^2}$ in the parabolic case, the NLL is
multiplied by a factor $\alpha$:
\begin{equation}
  \label{eq:NLLPara_alpha}
  \text{NLL}'(\mu) \approx \frac{\alpha}{2\,\sigma_\mu^2}\, (\mu-\hat{\mu})^2 + C' \ .
\end{equation}
This will make the shape of the parabola around the NLL minimum wider (if $\alpha$\textlt1) or narrower (if $\alpha$\textgt1). Notice that
this does not affect the position of the minimum, from which the parameter values are estimated.

Note that whereas the factor $\alpha$ is an exact correction for the uncertainty estimate of the expected number of decays in the above
example, it is only an approximate correction for the parameters in the NLL. The resulting uncertainties have to be checked by evaluating
the shape of the distribution of parameter estimates in simulated experiments, as will be discussed in Sections~\ref{sec:ana_sim} and
\ref{sec:result_paramEst}.

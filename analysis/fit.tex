\section{Maximum-Likelihood Fit}
\label{sec:ana_fit}

The fit of the decay model to the data is an \emph{unbinned maximum-likelihood fit}. A probability density function (PDF) is constructed by
normalizing the expression for the differential decay rate, including experimental effects, by dividing by its integral over decay time and
decay angles. A likelihood function of the PDF parameters for a single $\Bs$ decay is given by the PDF at the values of the variables, e.g.
time and angles, for that decay. The likelihood function for the full sample of decays is given by the product of all individual
likelihoods.

Parameter values are estimated by maximizing the likelihood function for the sample. In practice, the negative logarithm of the likelihood
function (NLL) is minimized to find the maximum likelihood. Instead of a product, the NLL is a sum of the contributions from individual
decays.

The shape of the NLL around the minimum can be approximated by a second order Taylor series, i.e. a parabola. Since, by construction, the
first derivative of this function vanishes at the point where the NLL reaches its minimum, the approximation for a given parameter $\mu$
can be written in the form
\begin{equation}
  \label{eq:NLLPara}
  \text{NLL}(\mu) \approx \frac{1}{2\,\sigma_\mu^2}\, (\mu-\hat{\mu})^2 + C \ ,
\end{equation}
where $\hat{\mu}$ is the value of parameter $\mu$ in the minimum, $\sigma_\mu$ determines the width of the NLL shape around the minimum,
and $C$ is the NLL value in the minimum. The width, $\sigma_\mu$, is (related to) the statistical uncertainty of the estimate of parameter
$\mu$. The wider the NLL shape around the minimum, the larger the value of $\sigma_\mu$ and the uncertainty.

It depends on the actual shape of the NLL how well it is approximated by a parabola away from the minimum. An important factor is the
number of decays that is used to build the NLL. With more data the statistical uncertainties of the parameter estimates become smaller and,
in general, the NLL becomes more parabolic within an interval of a few times the value of $\sigma_\mu$ around the minimum.

In case the distribution of parameter estimates $\hat{\mu}$ from different measurements is described by a Gaussian shape, the shape of the
NLL will be truly parabolic. In this case the parameter $\sigma_\mu$ is an estimate of the standard deviation of the $\hat{\mu}$
distribution, which can be used as a measure of the statistical uncertainty of the parameter estimate. The parameter interval between
the values $\hat{\mu}$\textminus$\sigma_\mu$ and $\hat{\mu}$\textplus$\sigma_\mu$ contains the true value of $\mu$ in 68\% of the
measurements in the Gaussian case. This is an example of a \emph{confidence interval} with, in this case, a \emph{coverage} of 68\%. The
value of $\sigma_\mu$ is determined from the second derivative of the NLL, which is given by $\frac{1}{\sigma_\mu^2}$.

If the shape of the NLL around its minimum is not sufficiently parabolic, the value of $\sigma_\mu$ and the interval defined by the values
$\hat{\mu}$\textpm$\sigma_\mu$ are still well defined, but may not provide the desired measure of the uncertainty in the parameter
estimate.  In general, the value of $\sigma_\mu$ is not a good estimate of the $\hat{\mu}$ standard deviation and the corresponding
confidence interval does not have a coverage of 68\%.

A more general method, which constructs a confidence interval with a coverage of approximately 68\%, defines the interval as the range of
$\mu$ values between the points where the NLL reaches a value of $\tfrac{1}{2}+C$. In the parabolic case the NLL reaches this point at
$\hat{\mu}$\textpm$\sigma_\mu$, which results in the expected Gaussian confidence interval with corresponding uncertainty $\sigma_\mu$. In
a more general case this NLL value may be reached at different distances below and above the value of $\hat{\mu}$, which results in an
asymmetric uncertainty.

If the NLL has multiple minima or a very broad, shallow minimum, a point estimate of the parameter value is not representative for the
$\hat{\mu}$ distribution and the estimate is usually represented by confidence intervals only. A straightforward way of constructing these
intervals is to determine the points between which the NLL is smaller than a certain value, as was done above with $\tfrac{1}{2}+C$. Common
NLL values to use are the values that a parabola would reach at $n\cdot\sigma_\mu$ from the minimum, which are given by
$\tfrac{1}{2}\,n^2+C$. Hence the intervals are referred to as \emph{$n$-sigma intervals}.

In general the NLL is a function of multiple parameters, which are estimated by the values that minimize this multivariate function.  The
uncertainty for an individual parameter, $\mu$, can be obtained by minimizing the NLL with respect to all other parameters for each value
of $\mu$ and applying the techniques discussed above. The likelihood function corresponding to the resulting NLL for $\mu$ is called a
\emph{profile likelihood}.

In the Gaussian case, the distribution of parameter estimates is given by a multivariate Gaussian shape. A covariance matrix containing the
standard deviations and correlation coefficients of the parameter estimates takes the place of $\sigma_\mu^2$ in Equation~\ref{eq:NLLPara}.
The elements of the (inverse) covariance matrix are estimated by the second-order partial derivatives of the NLL in the minimum for all
pairs of parameters. Constructing the profile likelihood for parameter $\mu$, the minimum of the NLL in all other parameters, $\nu_i$, for
a given $\mu$ value is reached at
\begin{equation}
  \frac{1}{\sigma_{\nu_i}}\, (\nu_i-\hat{\nu}_i)  = \rho_{\mu\nu_i}\, \frac{1}{\sigma_\mu}\, (\mu-\hat{\mu})\ ,
\end{equation}
where $\rho_{\mu\nu_i}$ is the correlation coefficient between the parameters $\mu$ and $\nu_i$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Fit with Weighted Decay Candidates}
\label{subsec:ana_fit_weights}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

As will be described in Section~\ref{sec:ana_bkgSub}, the time and angular distribution for \BstoJpsiKK{} signal decays is obtained by
subtracting the background distribution from the distribution that is observed in the data. This is accomplished by adding background
decay-candidates to the sample with negative weights. In the NLL, the contribution of each decay candidate is then multiplied with the
value of its weight.

Although the position of the minimum of a weighted NLL still gives a good estimate of the values of the NLL parameters, the parameter
uncertainties cannot be estimated directly from the shape of the NLL at its minimum any more. This can be seen by considering a fit in
intervals of a given variable, where the observed number of decays in each interval is compared to the prediction of this number by a
model. The uncertainties in the estimates of the model parameters are now related to the uncertainties in the observed number of decays in
each interval.

For unweighted decays the distribution of the observed number of decays ($N$) is a Poisson distribution, for which both the mean and the
variance are given by the expected number in the interval ($\nu$). An estimate of the expected number of decays, $\hat{\nu}$, is given by
$N$ and an estimate of the corresponding uncertainty by the square root of the estimated variance, $\sqrt{N}$.

In a fit with weighted decay candidates, where each candidate counts with a weight $w_c$, the observed number of decays is replaced by the
sum of weights, $W$\textequiv$\sum_c w_c$. The estimate of $\nu$ is now also given by $W$, as expected, but the uncertainty is estimated by
$\sqrt{W}$, which cannot be correct. If all weights are multiplied by a constant number, $n$, the relative uncertainty in the estimate of
$\nu$ should not change, since no information was added to the data sample. This means that the absolute uncertainty should increase by a
factor $n$, as $\hat{\nu}$\texteq$W$ does. If the uncertainty is estimated by $\sqrt{W}$, it only increases by a factor $\sqrt{n}$.

The correct uncertainty estimate for the expected number of decays is given by the square root of $W'$\textequiv$\sum_c w_c^2$. Unlike
$\sqrt{W}$, $\sqrt{W'}$ increases by a factor $n$ if all weights are multiplied by this common factor. To obtain this estimate of the
uncertainty, the original estimate from the Poisson distribution should be divided by a factor $\sqrt{\alpha}$, where $\alpha$ is given by
\begin{equation}
  \alpha \equiv \frac{W}{W'} = \frac{\sum_c w_c}{\sum_c w_c^2} \ .
\end{equation}

In an unbinned maximum likelihood fit the correction factor $\alpha$ can be used to modify the shape of the NLL. Since the uncertainties
are estimated from the second derivatives of the NLL, which are given by $\frac{1}{\sigma_\mu^2}$ in the parabolic case, the NLL is
multiplied by a factor $\alpha$:
\begin{equation}
  \label{eq:NLLPara_alpha}
  \text{NLL}'(\mu) \approx \frac{\alpha}{2\,\sigma_\mu^2}\, (\mu-\hat{\mu})^2 + C' \ .
\end{equation}
This will make the shape of the parabola around the NLL minimum wider (if $\alpha$\textlt1) or narrower (if $\alpha$\textgt1). Notice that
this does not affect the position of the minimum, from which the parameter values are estimated.

Note that this procedure was designed to correct the uncertainty estimates for parameter distributions with a variance that scales with the
observed number of decays. In other cases the correctness of the obtained results is not guaranteed. The resulting uncertainties are
verified by evaluating the shape of the distribution of parameter estimates in simulated experiments, as will be discussed in
Sections~\ref{sec:ana_sim} and \ref{sec:result_paramEst}.
